# 《攻城掠地》桌游项目 - 日志轮转配置

# 应用日志
/var/log/siege-game/*.log {
    daily
    missingok
    rotate 30
    compress
    delaycompress
    notifempty
    create 0644 gameapp gameapp
    postrotate
        # 重启应用以重新打开日志文件
        if [ -f /var/run/siege-game.pid ]; then
            kill -USR1 $(cat /var/run/siege-game.pid)
        fi
        # 或者重启PM2应用
        if command -v pm2 > /dev/null; then
            pm2 reloadLogs
        fi
    endscript
}

# Nginx访问日志
/var/log/nginx/siege-game-access.log {
    daily
    missingok
    rotate 52
    compress
    delaycompress
    notifempty
    create 0644 www-data www-data
    sharedscripts
    postrotate
        if [ -f /var/run/nginx.pid ]; then
            kill -USR1 $(cat /var/run/nginx.pid)
        fi
    endscript
}

# Nginx错误日志
/var/log/nginx/siege-game-error.log {
    daily
    missingok
    rotate 52
    compress
    delaycompress
    notifempty
    create 0644 www-data www-data
    sharedscripts
    postrotate
        if [ -f /var/run/nginx.pid ]; then
            kill -USR1 $(cat /var/run/nginx.pid)
        fi
    endscript
}

# PM2日志
/home/gameapp/.pm2/logs/*.log {
    daily
    missingok
    rotate 30
    compress
    delaycompress
    notifempty
    create 0644 gameapp gameapp
    postrotate
        if command -v pm2 > /dev/null; then
            sudo -u gameapp pm2 reloadLogs
        fi
    endscript
}

# 系统监控日志
/var/log/siege-game/monitoring/*.log {
    weekly
    missingok
    rotate 12
    compress
    delaycompress
    notifempty
    create 0644 gameapp gameapp
}

# 安全日志
/var/log/siege-game/security/*.log {
    daily
    missingok
    rotate 90
    compress
    delaycompress
    notifempty
    create 0600 root root
}

# 备份日志
/var/log/siege-game/backup/*.log {
    weekly
    missingok
    rotate 8
    compress
    delaycompress
    notifempty
    create 0644 gameapp gameapp
}

# 部署日志
/var/log/siege-game/deployment/*.log {
    monthly
    missingok
    rotate 12
    compress
    delaycompress
    notifempty
    create 0644 gameapp gameapp
}

# 健康检查日志
/var/log/siege-game/health-check.log {
    weekly
    missingok
    rotate 8
    compress
    delaycompress
    notifempty
    create 0644 gameapp gameapp
}